<!DOCTYPE html>
<html>
<head>
<title>Apache Tomcat WebSocket Examples: Echo</title>
<script src="/sockjs.js"></script>
<script type="text/javascript">
	var ws = null;

	function setConnected(connected) {
		document.getElementById('connect').disabled = connected;
		document.getElementById('disconnect').disabled = !connected;
		document.getElementById('echo').disabled = !connected;
	}

	function connect() {
		var target = document.getElementById('target').value;
		if (target == '') {
			alert('Please select server side connection implementation.');
			return;
		}
		ws = new SockJS(target);
		ws.onopen = function() {
			setConnected(true);
			log('Info: WebSocket connection opened.');
		};
		ws.onmessage = function(event) {
			log('Received: ' + event.data);
		};
		ws.onclose = function() {
			setConnected(false);
			log('Info: WebSocket connection closed.');
		};
		ws.onerror = function(e) {
			log('on error:' + e.message)
		}
	}

	function disconnect() {
		if (ws != null) {
			ws.close();
			ws = null;
		}
		setConnected(false);
	}

	function echo() {
		if (ws != null) {
			var message = document.getElementById('message').value;
			log('Sent: ' + message);

			// Send it now
			ws.send(message);
		} else {
			alert('WebSocket connection not established, please connect.');
		}
	}

	function updateTarget(target) {
		if (window.location.protocol == 'http:') {
			document.getElementById('target').value = 'http://'
					+ window.location.host + target;
		} else {
			document.getElementById('target').value = 'https://'
					+ window.location.host + target;
		}
	}

	function log(message) {
		var console = document.getElementById('console');
		var p = document.createElement('p');
		p.style.wordWrap = 'break-word';
		p.appendChild(document.createTextNode(message));
		console.appendChild(p);
		while (console.childNodes.length > 25) {
			console.removeChild(console.firstChild);
		}
		console.scrollTop = console.scrollHeight;
	}
</script>
</head>
<body>
	<noscript>
		<h2 style="color: #ff0000">Seems your browser doesn't support
			Javascript! Websockets rely on Javascript being enabled. Please
			enable Javascript and reload this page!</h2>
	</noscript>
	<div>
		<div id="connect-container">
			<div>
				<span>Connect using:</span><br>
				<!-- echo example using streams on the server side -->
				<input id="radio1" type="radio" name="group1"
					value="/springws/bean_sockjs" onclick="updateTarget(this.value);">
				<label for="radio1">springwsbean_sockjs</label><br>
				<!-- echo example using messages on the server side -->
				<input id="radio2" type="radio" name="group1"
					value="/springws/xml_sockjs" onclick="updateTarget(this.value);">
				<label for="radio2">springwsxml_sockjs</label><br>
			</div>
			<div>
				<input id="target" type="text" size="40" style="width: 350px" />
			</div>
			<div>
				<button id="connect" onclick="connect();">Connect</button>
				<button id="disconnect" disabled="disabled" onclick="disconnect();">Disconnect</button>
			</div>
			<div>
				<textarea id="message" style="width: 350px">Here is a message!</textarea>
			</div>
			<div>
				<button id="echo" onclick="echo();" disabled="disabled">Echo
					message</button>
			</div>
		</div>
		<div id="console-container">
			<div id="console"></div>
		</div>
	</div>
</body>
</html>